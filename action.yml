name: 'GitHub Actions Pinner'
description: 'Validate GitHub Actions to ensure they use specific commit SHAs for improved security'
author: 'gha-pinner'
branding:
  icon: 'anchor'
  color: 'blue'

inputs:
  target:
    description: 'File or directory to validate actions in'
    required: true
    default: '.github/workflows'
  target-type:
    description: 'Type of target (file or dir)'
    required: false
    default: 'dir'
    enum: ['file', 'dir']

runs:
  using: 'composite'
  steps:
    - name: Set up Python
      uses: actions/setup-python@a26af69be951a213d495a4c3e4e4022e16d87065 # v4
      with:
        python-version: '3.10'
        cache: 'pip'

    - name: Install gha-pinner
      shell: bash
      run: |
        pip install ${{ github.action_path }}

    - name: Generate suggestions
      if: ${{ github.event_name == 'pull_request' }}
      shell: bash
      run: |
        gha-pinner ${{ inputs.target-type }} "${{ inputs.target }}"

    - name: Suggest fixes on the PR
      if: ${{ github.event_name == 'pull_request' }}
      uses: reviewdog/action-suggester@4747dbc9f9e37adba0943e681cc20db466642158 # v1
      with:
        tool_name: gha-pinner
      env:
        REVIEWDOG_GITHUB_API_TOKEN: ${{ github.token }}
